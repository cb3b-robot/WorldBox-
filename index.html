<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WorldBox-Style World (Tile Prototype)</title>
<style>
  :root {
    --bg: #020617;
    --panel: #020617;
    --panel2: #020617;
    --accent: #38bdf8;
    --accent-soft: rgba(56,189,248,0.15);
    --muted: #9ca3af;
    --text: #e5e7eb;
    --danger: #f97373;
  }
  * {
    box-sizing: border-box;
  }
  html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background: radial-gradient(circle at top,#0f172a 0%,#020617 55%);
    color: var(--text);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }
  .page {
    display:flex;
    flex-direction:row;
    height:100vh;
    padding:8px;
    gap:8px;
  }
  @media (max-width: 900px) {
    .page {
      flex-direction:column;
    }
  }
  .left {
    flex: 3;
    background: radial-gradient(circle at top,#0b1220 0%,#020617 65%);
    border-radius:10px;
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:8px;
    box-shadow:0 18px 40px rgba(0,0,0,0.55);
  }
  .right {
    flex: 2;
    background: linear-gradient(180deg,#020617,#020617);
    border-radius:10px;
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
    box-shadow:0 18px 40px rgba(0,0,0,0.6);
  }
  header {
    display:flex;
    align-items:center;
    gap:10px;
  }
  header h1 {
    margin:0;
    font-size:18px;
    letter-spacing:0.03em;
  }
  header span.badge {
    font-size:11px;
    padding:2px 8px;
    border-radius:999px;
    background:rgba(34,197,94,0.1);
    color:#4ade80;
    border:1px solid rgba(34,197,94,0.3);
  }
  header .sub {
    margin-left:auto;
    font-size:12px;
    color:var(--muted);
  }
  #mapContainer {
    position:relative;
    flex:1;
    border-radius:8px;
    overflow:hidden;
    background: radial-gradient(circle at top,#0ea5e9,#0369a1 45%,#0f172a 100%);
    border:1px solid rgba(15,23,42,0.9);
  }
  #worldCanvas {
    width:100%;
    height:100%;
    display:block;
  }
  .legend {
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    align-items:center;
    margin-top:4px;
  }
  .pill {
    font-size:11px;
    padding:4px 8px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,0.35);
    color:#e5e7eb;
    background:rgba(15,23,42,0.85);
  }
  .controls {
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin-top:2px;
  }
  button {
    border:none;
    border-radius:6px;
    padding:6px 10px;
    background:var(--accent);
    color:#020617;
    font-weight:600;
    font-size:12px;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    gap:4px;
    box-shadow:0 8px 22px rgba(56,189,248,0.35);
  }
  button.secondary {
    background:rgba(15,23,42,0.9);
    color:var(--muted);
    border:1px solid rgba(148,163,184,0.35);
    box-shadow:none;
  }
  button:active {
    transform:translateY(1px);
    box-shadow:none;
  }
  #status {
    font-size:12px;
    color:var(--muted);
    margin-left:auto;
  }

  .panel-title {
    font-size:14px;
    font-weight:600;
    margin-bottom:2px;
  }
  .small {
    font-size:12px;
    color:var(--muted);
  }
  .info-box {
    background:rgba(15,23,42,0.9);
    border-radius:8px;
    padding:8px;
    border:1px solid rgba(148,163,184,0.25);
  }
  .info-row {
    display:flex;
    justify-content:space-between;
    gap:10px;
    font-size:12px;
    margin-top:3px;
  }
  .info-row span.label {
    color:var(--muted);
  }
  .info-row span.value {
    font-weight:500;
  }
  .country-list {
    flex:1;
    overflow:auto;
    padding:6px;
    border-radius:8px;
    background:radial-gradient(circle at top,#020617,#020617 60%);
    border:1px solid rgba(15,23,42,0.9);
  }
  .country-row {
    display:flex;
    align-items:center;
    justify-content:space-between;
    font-size:12px;
    padding:4px 6px;
    border-radius:6px;
    cursor:pointer;
    margin-bottom:2px;
  }
  .country-row:hover {
    background:rgba(15,23,42,0.95);
  }
  .country-row .color-dot {
    width:10px;
    height:10px;
    border-radius:3px;
    margin-right:6px;
  }
  .country-row-name {
    display:flex;
    align-items:center;
    gap:4px;
    flex:1;
  }
  .country-row-pop {
    color:var(--muted);
    font-size:11px;
  }
  .country-row.selected {
    background:var(--accent-soft);
    border:1px solid rgba(56,189,248,0.6);
  }
  .bar-bg {
    position:relative;
    width:100%;
    height:6px;
    border-radius:999px;
    background:rgba(15,23,42,0.9);
    overflow:hidden;
  }
  .bar-fill {
    position:absolute;
    left:0;
    top:0;
    bottom:0;
    border-radius:999px;
    background:linear-gradient(90deg,#22c55e,#38bdf8);
    width:0%;
  }

  footer {
    font-size:11px;
    color:var(--muted);
    border-top:1px solid rgba(15,23,42,0.9);
    padding-top:6px;
    margin-top:4px;
  }
</style>
</head>
<body>
<div class="page">
  <section class="left">
    <header>
      <h1>WorldBox-Style World</h1>
      <span class="badge">Tile prototype</span>
      <div class="sub">1 population unit = 1 million people (rounded up)</div>
    </header>
    <div id="mapContainer">
      <canvas id="worldCanvas"></canvas>
    </div>
    <div class="legend">
      <div class="pill">Tap tiles to select a country</div>
      <div class="pill">Borders are regular blocks on a grid</div>
      <div style="margin-left:auto; display:flex; gap:8px; align-items:center; width:100%; flex-wrap:wrap;">
        <div class="controls">
          <button id="btnRandomTick"><span>⚡</span><span>Random population tick</span></button>
          <button id="btnReset" class="secondary">Reset populations</button>
        </div>
        <div id="status">Ready</div>
      </div>
    </div>
  </section>

  <aside class="right">
    <div>
      <div class="panel-title">Selected country</div>
      <div class="info-box">
        <div style="display:flex; align-items:center; gap:6px;">
          <div id="infoColorDot" style="width:14px;height:14px;border-radius:4px;background:#0f172a;border:1px solid rgba(148,163,184,0.6);"></div>
          <div>
            <div id="infoName" style="font-weight:600;font-size:13px;">None</div>
            <div id="infoRegion" class="small">Tap a land tile to inspect.</div>
          </div>
        </div>
        <div class="info-row">
          <span class="label">Population (millions)</span>
          <span class="value" id="infoPopMillions">—</span>
        </div>
        <div class="info-row">
          <span class="label">Population units</span>
          <span class="value" id="infoPopUnits">—</span>
        </div>
        <div class="info-row">
          <span class="label">Relative size</span>
          <span class="value" id="infoRelative">—</span>
        </div>
        <div class="bar-bg" style="margin-top:6px;">
          <div class="bar-fill" id="infoBar"></div>
        </div>
      </div>
      <div class="small" style="margin-top:4px;">
        Populations are rough, hard-coded examples.
        Each population unit represents ~1 million people, rounded up.
      </div>
    </div>

    <div>
      <div class="panel-title" style="margin-top:6px;">Countries in this prototype</div>
      <div class="small">Roughly laid out like the real world: Americas on the left, Europe/Africa in the middle, Asia/Oceania on the right.</div>
    </div>
    <div class="country-list" id="countryList"></div>

    <footer>
      Tip: Put this file in a GitHub repo as <code>index.html</code> and enable GitHub Pages to play it from your iPad.
    </footer>
  </aside>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("worldCanvas");
  const ctx = canvas.getContext("2d");
  const statusEl = document.getElementById("status");
  const mapContainer = document.getElementById("mapContainer");

  // Info panel elements
  const infoName = document.getElementById("infoName");
  const infoRegion = document.getElementById("infoRegion");
  const infoPopMillions = document.getElementById("infoPopMillions");
  const infoPopUnits = document.getElementById("infoPopUnits");
  const infoRelative = document.getElementById("infoRelative");
  const infoBar = document.getElementById("infoBar");
  const infoColorDot = document.getElementById("infoColorDot");
  const countryListEl = document.getElementById("countryList");

  const btnRandomTick = document.getElementById("btnRandomTick");
  const btnReset = document.getElementById("btnReset");

  // --- WORLD SETUP ---
  const GRID_W = 160;   // horizontal tiles
  const GRID_H = 90;    // vertical tiles

  const WATER = null;

  // Rough world countries; populations in millions (approx, just for demo)
  const countries = [
    { id:"canada",        name:"Canada",              region:"North America", color:"#38bdf8", populationMillions: 40 },
    { id:"usa",           name:"United States",       region:"North America", color:"#f97316", populationMillions: 339 },
    { id:"mexico",        name:"Mexico",              region:"North America", color:"#fb7185", populationMillions: 129 },
    { id:"brazil",        name:"Brazil",              region:"South America", color:"#22c55e", populationMillions: 216 },
    { id:"argentina",     name:"Argentina",           region:"South America", color:"#a3e635", populationMillions: 46 },
    { id:"uk",            name:"United Kingdom",      region:"Europe",        color:"#e5e7eb", populationMillions: 68 },
    { id:"france",        name:"France",              region:"Europe",        color:"#facc15", populationMillions: 65 },
    { id:"germany",       name:"Germany",             region:"Europe",        color:"#fbbf24", populationMillions: 84 },
    { id:"nigeria",       name:"Nigeria",             region:"Africa",        color:"#4ade80", populationMillions: 223 },
    { id:"egypt",         name:"Egypt",               region:"Africa",        color:"#2dd4bf", populationMillions: 112 },
    { id:"south_africa",  name:"South Africa",        region:"Africa",        color:"#22c55e", populationMillions: 61 },
    { id:"russia",        name:"Russia",              region:"Eurasia",       color:"#60a5fa", populationMillions: 144 },
    { id:"china",         name:"China",               region:"Asia",          color:"#f97373", populationMillions: 1420 },
    { id:"india",         name:"India",               region:"Asia",          color:"#f97316", populationMillions: 1429 },
    { id:"japan",         name:"Japan",               region:"Asia",          color:"#f9a8d4", populationMillions: 125 },
    { id:"indonesia",     name:"Indonesia",           region:"Asia",          color:"#22c55e", populationMillions: 277 },
    { id:"australia",     name:"Australia",           region:"Oceania",       color:"#38bdf8", populationMillions: 26 }
  ];

  // Compute population units and derived/faster lookup
  const countriesById = {};
  let maxUnits = 0;
  for (const c of countries) {
    c.populationUnits = Math.ceil(c.populationMillions); // 38M -> 38 units
    countriesById[c.id] = c;
    if (c.populationUnits > maxUnits) maxUnits = c.populationUnits;
  }

  // Tile map: 2D array [y][x] -> countryId or WATER
  const tiles = Array.from({length: GRID_H}, () => Array(GRID_W).fill(WATER));

  function fillRectCountry(id, x0, y0, x1, y1) {
    for (let y = y0; y < y1; y++) {
      if (y < 0 || y >= GRID_H) continue;
      const row = tiles[y];
      for (let x = x0; x < x1; x++) {
        if (x < 0 || x >= GRID_W) continue;
        row[x] = id;
      }
    }
  }

  function buildWorld() {
    // Start with water everywhere (already done)
    // Then stamp continents & countries roughly where they belong.

    // North America
    fillRectCountry("canada", 14, 8, 60, 26);   // top left
    fillRectCountry("usa",    18, 26, 60, 42);
    fillRectCountry("mexico", 24, 42, 50, 52);

    // South America
    fillRectCountry("brazil",    40, 50, 70, 78);
    fillRectCountry("argentina", 46, 66, 66, 84);

    // Europe
    fillRectCountry("uk",      76, 18, 82, 26);
    fillRectCountry("france",  82, 26, 90, 34);
    fillRectCountry("germany", 90, 22, 100, 34);

    // Africa
    fillRectCountry("egypt",        92, 34, 112, 44);
    fillRectCountry("nigeria",      92, 44, 108, 62);
    fillRectCountry("south_africa", 94, 62, 112, 84);

    // Eurasia / Asia
    fillRectCountry("russia",  80, 8, 150, 28);
    fillRectCountry("china",   108, 30, 140, 50);
    fillRectCountry("india",   104, 50, 124, 66);
    fillRectCountry("indonesia", 118, 62, 142, 78);
    fillRectCountry("japan",   142, 34, 152, 44);

    // Australia / Oceania
    fillRectCountry("australia", 130, 66, 156, 86);
  }

  // --- DRAWING ---

  let selectedCountryId = null;

  function lightenColor(hex, amt = 40) {
    let col = hex.replace("#", "");
    if (col.length === 3) {
      col = col.split("").map(c => c + c).join("");
    }
    let num = parseInt(col, 16);
    let r = (num >> 16) + amt;
    let g = ((num >> 8) & 0xff) + amt;
    let b = (num & 0xff) + amt;
    r = Math.min(255, Math.max(0, r));
    g = Math.min(255, Math.max(0, g));
    b = Math.min(255, Math.max(0, b));
    return "#" + ((r << 16) | (g << 8) | b).toString(16).padStart(6, "0");
  }

  function resizeCanvas() {
    const rect = mapContainer.getBoundingClientRect();
    const ratio = window.devicePixelRatio || 1;
    const width = rect.width;
    const height = rect.width * 0.56; // 16:9-ish

    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
    canvas.width = Math.floor(width * ratio);
    canvas.height = Math.floor(height * ratio);

    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);

    drawWorld();
  }

  function drawWorld() {
    const rect = canvas.getBoundingClientRect();
    const width = rect.width;
    const height = rect.height;
    const tileW = width / GRID_W;
    const tileH = height / GRID_H;

    // Background water
    ctx.fillStyle = "#082f49";
    ctx.fillRect(0, 0, width, height);

    // Optional: subtle noise (we'll fake it by light random variations on water)
    for (let y = 0; y < GRID_H; y += 3) {
      for (let x = 0; x < GRID_W; x += 3) {
        if (tiles[y][x] !== WATER) continue;
        ctx.fillStyle = Math.random() < 0.5 ? "#083344" : "#0b3b56";
        ctx.fillRect(x * tileW, y * tileH, tileW, tileH);
      }
    }

    // Land tiles
    for (let y = 0; y < GRID_H; y++) {
      const row = tiles[y];
      for (let x = 0; x < GRID_W; x++) {
        const id = row[x];
        if (!id) continue;
        const country = countriesById[id];
        if (!country) continue;
        const base = country.color;
        const fill = (id === selectedCountryId) ? lightenColor(base, 60) : base;
        ctx.fillStyle = fill;
        ctx.fillRect(x * tileW, y * tileH, tileW + 0.4, tileH + 0.4);
      }
    }

    // Draw chunky coastlines (simple effect: outline border between water and land)
    ctx.strokeStyle = "rgba(15,23,42,0.9)";
    ctx.lineWidth = Math.max(1, tileW * 0.4);
    ctx.lineCap = "square";
    ctx.beginPath();
    for (let y = 0; y < GRID_H; y++) {
      for (let x = 0; x < GRID_W; x++) {
        const id = tiles[y][x];
        if (!id) continue;
        const up = y > 0 ? tiles[y - 1][x] : id;
        const down = y < GRID_H - 1 ? tiles[y + 1][x] : id;
        const left = x > 0 ? tiles[y][x - 1] : id;
        const right = x < GRID_W - 1 ? tiles[y][x + 1] : id;
        if (up !== id || down !== id || left !== id || right !== id) {
          const cx = (x + 0.5) * tileW;
          const cy = (y + 0.5) * tileH;
          ctx.moveTo(cx - tileW * 0.55, cy);
          ctx.lineTo(cx + tileW * 0.55, cy);
        }
      }
    }
    ctx.stroke();
  }

  // --- INPUT & INFO PANEL ---

  function pickCountryAtClientPos(clientX, clientY) {
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left;
    const y = clientY - rect.top;
    if (x < 0 || y < 0 || x > rect.width || y > rect.height) return null;

    const gridX = Math.floor(x / (rect.width / GRID_W));
    const gridY = Math.floor(y / (rect.height / GRID_H));
    if (gridY < 0 || gridY >= GRID_H || gridX < 0 || gridX >= GRID_W) return null;
    return tiles[gridY][gridX];
  }

  function updateInfoPanel(id) {
    if (!id || !countriesById[id]) {
      infoName.textContent = "None";
      infoRegion.textContent = "Tap a land tile to inspect.";
      infoPopMillions.textContent = "—";
      infoPopUnits.textContent = "—";
      infoRelative.textContent = "—";
      infoBar.style.width = "0%";
      infoColorDot.style.background = "#0f172a";
      return;
    }
    const c = countriesById[id];
    infoName.textContent = c.name;
    infoRegion.textContent = c.region;
    infoPopMillions.textContent = c.populationMillions.toLocaleString("en-US");
    infoPopUnits.textContent = c.populationUnits.toLocaleString("en-US");
    const rel = Math.round((c.populationUnits / maxUnits) * 100);
    infoRelative.textContent = rel + "% of biggest in world";
    infoBar.style.width = rel + "%";
    infoColorDot.style.background = c.color;
  }

  function rebuildCountryList() {
    countryListEl.innerHTML = "";
    const sorted = [...countries].sort((a,b) => b.populationMillions - a.populationMillions);
    for (const c of sorted) {
      const row = document.createElement("div");
      row.className = "country-row";
      row.dataset.id = c.id;

      const nameSpan = document.createElement("div");
      nameSpan.className = "country-row-name";
      const colorDot = document.createElement("div");
      colorDot.className = "color-dot";
      colorDot.style.background = c.color;
      const text = document.createElement("span");
      text.textContent = c.name;
      nameSpan.appendChild(colorDot);
      nameSpan.appendChild(text);

      const popSpan = document.createElement("div");
      popSpan.className = "country-row-pop";
      popSpan.textContent = `${c.populationMillions}M (${c.populationUnits})`;

      row.appendChild(nameSpan);
      row.appendChild(popSpan);

      row.addEventListener("click", () => {
        selectedCountryId = c.id;
        updateInfoPanel(selectedCountryId);
        highlightSelectedRow();
        drawWorld();
      });

      countryListEl.appendChild(row);
    }
    highlightSelectedRow();
  }

  function highlightSelectedRow() {
    const rows = countryListEl.querySelectorAll(".country-row");
    rows.forEach(row => {
      if (row.dataset.id === selectedCountryId) {
        row.classList.add("selected");
      } else {
        row.classList.remove("selected");
      }
    });
  }

  canvas.addEventListener("click", (evt) => {
    const id = pickCountryAtClientPos(evt.clientX, evt.clientY);
    if (!id) {
      selectedCountryId = null;
    } else {
      selectedCountryId = id;
    }
    updateInfoPanel(selectedCountryId);
    highlightSelectedRow();
    drawWorld();
  });

  // Touch support for iPad
  canvas.addEventListener("touchstart", (evt) => {
    const t = evt.touches[0];
    const id = pickCountryAtClientPos(t.clientX, t.clientY);
    if (!id) {
      selectedCountryId = null;
    } else {
      selectedCountryId = id;
    }
    updateInfoPanel(selectedCountryId);
    highlightSelectedRow();
    drawWorld();
  }, {passive:true});

  // --- SIMPLE POPULATION SIMULATION ---

  function randomTick() {
    statusEl.textContent = "Random tick...";
    for (const c of countries) {
      const change = Math.random() < 0.6 ? 0 : (Math.random() < 0.5 ? 1 : -1);
      const newMillions = Math.max(1, c.populationMillions + change);
      c.populationMillions = newMillions;
      c.populationUnits = Math.ceil(newMillions);
    }
    // Recompute maxUnits for relative bar
    maxUnits = 0;
    for (const c of countries) {
      if (c.populationUnits > maxUnits) maxUnits = c.populationUnits;
    }
    rebuildCountryList();
    updateInfoPanel(selectedCountryId);
    statusEl.textContent = "Tick complete";
  }

  function resetPopulations() {
    statusEl.textContent = "Resetting populations...";
    // Reset to original approximate values
    const baseValues = {
      canada: 40, usa: 339, mexico:129, brazil:216, argentina:46,
      uk:68, france:65, germany:84,
      nigeria:223, egypt:112, south_africa:61,
      russia:144, china:1420, india:1429, japan:125, indonesia:277, australia:26
    };
    for (const c of countries) {
      const base = baseValues[c.id];
      if (base) {
        c.populationMillions = base;
        c.populationUnits = Math.ceil(base);
      }
    }
    maxUnits = 0;
    for (const c of countries) {
      if (c.populationUnits > maxUnits) maxUnits = c.populationUnits;
    }
    rebuildCountryList();
    updateInfoPanel(selectedCountryId);
    statusEl.textContent = "Ready";
  }

  btnRandomTick.addEventListener("click", () => {
    randomTick();
  });

  btnReset.addEventListener("click", () => {
    resetPopulations();
  });

  // --- INIT ---
  statusEl.textContent = "Building world...";
  buildWorld();
  rebuildCountryList();
  selectedCountryId = "usa";
  updateInfoPanel(selectedCountryId);
  statusEl.textContent = "Ready";

  window.addEventListener("resize", () => {
    resizeCanvas();
  });
  resizeCanvas();
});
</script>
</body>
</html>
